libusbg-neXt (libusbgx)
-------

libusbgx is a C library encapsulating the kernel USB gadget-configfs
userspace API functionality.

It provides routines for creating and parsing USB gadget devices using
the configfs API. Currently, all USB gadget configfs functions that can
be enabled in kernel release 3.11 (Linux for Workgroups!) are supported.

See the Doxygen docs and examples for complete details on the
programming API and INSTALL for installation of the library and
examples.

To run the examples:

$ mount -t configfs none /sys/kernel/config
$ gadget-acm-ecm
$ show-gadgets
ID 1d6b:0104 'g1'
  UDC			3f120000.usbotg
  bDeviceClass		0x00
  bDeviceSubClass	0x00
  bDeviceProtocol	0x00
  bMaxPacketSize0	0x40
  bcdDevice		0x0311
  bcdUSB		0x0000
  idVendor		0x1d6b
  idProduct		0x0104
  Serial Number		0123456789
  Manufacturer		Foo Inc.
  Product		Bar Gadget
  Function 'acm.usb0'
    port_num		0
  Function 'acm.usb1'
    port_num		1
  Function 'ecm.usb0'
    dev_addr		32:1b:dc:a4:bc:a2
    host_addr		82:b7:58:62:f6:31
    ifname		usb0
    qmult		5
  Configuration 'c.1'
    MaxPower		2
    bmAttributes	0x80
    configuration	CDC 2xACM+ECM
    acm.GS0 -> acm.usb0
    acm.GS1 -> acm.usb0
    ecm.usb0 -> ecm.usb0
    
libusbg-iap
-----------

url = https://github.com/cafedestiny/libusbgx-iap.git
branch = iap_dev 

New gadget driver with iAP2 / NCM Interface Configuration.
 

Test example is based on ST A5 EVM :-

1) Set usb mode using sys fs entries.

Example 1 :-

echo 1 > /sys/devices/platform/soc/48440000.usb-phy/usb_id
echo ON > /sys/devices/platform/soc/48440000.usb-phy/drvvbus_on_device_mode
echo HOST > /sys/devices/platform/soc/48440000.usb-phy/usb_mode

2) Send Vendor request to switch Apple device to host mode.
3) Load composite and gadget driver 

modprobe libcomposite
gadget-iap -u 1 (here 1 is usb port number)

4) create mount-point FunctionFS 

mkdir /var/volatile/tmp/ffs
mount usb1 -t functionfs  /var/volatile/tmp/ffs

5) Run application to create ep1 and ep2.

cd  /var/volatile/tmp/ffs
/home/root/ffs-test &
(TBD: url for ffs-test)

6) Switch Accessory to Device Mode.

Example 2 :-

echo 48500000.usb > /sys/kernel/config/usb_gadget/48500000.usb/UDC
echo DEVICE > /sys/devices/platform/soc/48440000.usb-phy/usb_mode
