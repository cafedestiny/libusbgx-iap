libusbg-iap
-----------

url = https://github.com/cafedestiny/libusbgx-iap.git
branch = iap_dev 

New gadget driver with iAP2 / NCM Interface Configuration.
 

Test example is based on ST A5 EVM :-

1) Set usb mode using sys fs entries.

Example 1 :-

echo 1 > /sys/devices/platform/soc/48440000.usb-phy/usb_id
echo ON > /sys/devices/platform/soc/48440000.usb-phy/drvvbus_on_device_mode
echo HOST > /sys/devices/platform/soc/48440000.usb-phy/usb_mode

2) Send Vendor request to switch Apple device to host mode.
3) Load composite and gadget driver 

modprobe libcomposite
gadget-iap -u 1 (here 1 is usb port number)

4) create mount-point FunctionFS 

mkdir /var/volatile/tmp/ffs
mount usb1 -t functionfs  /var/volatile/tmp/ffs

5) Run application to create ep1 and ep2.

cd  /var/volatile/tmp/ffs
/home/root/ffs-test &

6) Switch Accessory to Device Mode.

Example 2 :-

echo 48500000.usb > /sys/kernel/config/usb_gadget/48500000.usb/UDC
echo DEVICE > /sys/devices/platform/soc/48440000.usb-phy/usb_mode
